<!DOCTYPE html>
<html>

<head>
    <title>Now You See Me</title>
    <meta charset="UTF-8">

<!--     <script src='https://aframe.io/releases/0.9.2/aframe.min.js'></script> -->
<!--     <script src='https://aframe.io/releases/1.7.1/aframe.min.js'></script> -->
         <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
<!--     <script src="https://raw.githack.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script> -->
<!--     <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.2/aframe/build/aframe-ar.min.js"></script> -->
         <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <script src="https://rawgit.com/mayognaise/aframe-gif-shader/master/dist/aframe-gif-shader.min.js"></script>

    <style>
        /* í˜„ì¬ìœ„ì¹˜ í‘œì‹œì°½ */
        #gpsDisplay {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.6);
            color: #fff;
            padding: 8px 12px;
            font-family: monospace;
            font-size: 14px;
            border-radius: 6px;
            z-index: 999;
            white-space: pre-line;
        }

    </style>
</head>

<body style="margin: 0; overflow: hidden;">
    <div id="gpsDisplay">ğŸ“ GPS Loading...</div>


    <!-- í”ë“¤ë¦¼ ë³´ì •í• ë•Œ gpsMinAccuracyë¥¼ 50ìœ¼ë¡œ í•˜ëŠ”ê²Œ ê°€ì´ë“œì¸ë° ì˜ ì•ˆë˜ëŠ”ë“¯ -->
<!--     <a-scene vr-mode-ui="enabled: false" embedded arjs="sourceType: webcam; gpsMinAccuracy: 50; debugUIEnabled: false;"> -->
    <a-scene embedded arjs="sourceType: webcam; gpsMinAccuracy: 50;">

<!--         <a-camera gps-camera rotation-reader sky-detector cursor="rayOrigin: mouse"></a-camera> -->
        <a-camera gps-camera rotation-reader sky-detector>
          <a-entity cursor="rayOrigin: mouse"
            raycaster="objects: .intersectable"
            position="0 0 -1"
            geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
            material="color: black; shader: flat">
          </a-entity>
        </a-camera>

        <!-- ì´ë¯¸ì§€ í‘œì‹œ ê°ì²´ -->
        <!-- í•˜ëŠ˜ í–¥í• ë•Œ ë©”ì„¸ì§€ -->
        <!-- <a-entity id="skyMessage" position="0 10 0"
            text="value: â˜ï¸ í•˜ëŠ˜ì„ í–¥í•´ ë¹„ì¶”ì…¨êµ°ìš”!; align: center; color: yellow; width: 6" visible="false"></a-entity> -->
<!--         <a-image id="skyMessage" position="0 0 0" rotation="90 0 0"
            src="https://merkava5871.github.io/ar/assets/BGSong.png" width="1" height="1" visible="true">
        </a-image> -->
        <a-image id="skyMessage"
         position="0 0 0"
         rotation="0 90 0"
         src="https://merkava5871.github.io/ar/assets/BGSong.png"
         width="1"
         height="1"
         visible="true"
         class="intersectable">
        </a-image>

    </a-scene>

    <script>

        // íƒ€ê²Ÿ GPS ë³€ìˆ˜
        let targetLat = null;
        let targetLon = null;
        let objectsLoaded = false;

        // í˜„ì¬ìœ„ì¹˜ í‘œì‹œ
        const gpsDisplay = document.getElementById("gpsDisplay");
        navigator.geolocation.watchPosition(
            (pos) => {
                currentLat = pos.coords.latitude;
                currentLon = pos.coords.longitude;

                const lat = pos.coords.latitude.toFixed(6);
                const lon = pos.coords.longitude.toFixed(6);
                // const alt = pos.coords.altitude !== null ? pos.coords.altitude.toFixed(1) + "m" : "none";
                //ê¸°ìš¸ê¸° í‘œì‹œ
                const camera = document.querySelector('[gps-camera]');
                const rot = camera.getAttribute('rotation');
                const pitch = rot ? rot.x.toFixed(1) + "Â°" : "measuring";


                gpsDisplay.textContent =
                    `â†”ï¸ Lat: ${lat}\nâ†•ï¸ Lon: ${lon}\nğŸ“ Angle: ${pitch}`;
            },
            (err) => {
                gpsDisplay.textContent = "â— GPS not Found.";
            },
            { enableHighAccuracy: true }
        );

        document.addEventListener("DOMContentLoaded", () => {
          const imageEl = document.getElementById("skyMessage");
            

          // ëª¨ë°”ì¼ê³¼ PC ëª¨ë‘ ëŒ€ì‘
          imageEl.addEventListener("click", handleDownload);
          imageEl.addEventListener("touchend", handleDownload);

          function handleDownload(e) {
            e.preventDefault();
              alert("âœ… í´ë¦­ë¨!");
            const url = imageEl.getAttribute("src");
            const ext = url.split('.').pop().split('?')[0];
            const filename = `ar-content-${Date.now()}.${ext}`;

            // ëª¨ë°”ì¼ í˜¸í™˜ì„ ìœ„í•´ window.open ë°©ì‹ ì‚¬ìš©
            window.open(url, '_blank');
          }

    </script>


</body>

</html>
