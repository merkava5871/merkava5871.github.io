<!DOCTYPE html>
<html>
  <head>
    <title>HAE AR by BG</title>
<!--     <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script> -->
    <script src='https://aframe.io/releases/0.9.2/aframe.min.js'></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://rawgit.com/mayognaise/aframe-gif-shader/master/dist/aframe-gif-shader.min.js"></script>
    
<style>
  #gpsDisplay {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.6);
    color: #fff;
    padding: 8px 12px;
    font-family: monospace;
    font-size: 14px;
    border-radius: 6px;
    z-index: 999;
    white-space: pre-line;
  }
  #targetForm {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(255, 255, 255, 0.95);
    padding: 10px;
    border-radius: 6px;
    font-size: 14px;
    z-index: 999;
  }
    #arrivalMessage {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 128, 0, 0.85);
    color: #fff;
    padding: 20px 40px;
    font-size: 22px;
    font-weight: bold;
    border-radius: 12px;
    display: none;
    z-index: 999;
  }
</style>
  </head>
  
  <body style="margin: 0; overflow: hidden;">
    <div id="gpsDisplay">📍 위치 확인 중...</div>

<div id="targetForm">
  🎯 타겟 위치 입력<br/>
  위도: <input type="number" id="targetLat" step="0.000001"><br/>
  경도: <input type="number" id="targetLon" step="0.000001"><br/>
  <button onclick="updateTarget()">적용</button>
</div>

<div id="arrivalMessage">🎉 타겟 위치에 도착했습니다!</div>
    
    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; gpsMinAccuracy: 100; debugUIEnabled: false;"
    >
      <a-camera gps-camera rotation-reader></a-camera>

      <!-- 이미지 표시 객체 -->
<a-entity
  geometry="primitive: box; height: 2; width: 2; depth: 0.3"
  material="src: https://made-by-bg.s3.ap-northeast-2.amazonaws.com/Jiahn.png; side: double;"
  gps-entity-place="latitude: 37.526590; longitude: 126.887970;"
  look-at="[gps-camera]"
  scale="1 1 1"
  position="0 1 -3"
></a-entity>
      
<!--       <a-image
        src="https://made-by-bg.s3.ap-northeast-2.amazonaws.com/Jiahn.png"
        gps-entity-place="latitude: 37.526590; longitude: 126.887970;"
        look-at="[gps-camera]"
        scale="1 1 1"
        material="color: white; transparent: true; opacity: 1; side: double;"
        position="0 1 -1"
      ></a-image> -->

<!--       <a-entity
        geometry="primitive: plane; height: 2; width: 2"
        material="shader: gif; src: url(https://made-by-bg.s3.ap-northeast-2.amazonaws.com/arrow_direction_spin_right_md_nwm_v2.gif)"
        position="0 1.5 -3"
      ></a-entity> -->
    </a-scene>

<script>
  let targetLat = null;
  let targetLon = null;

  const arrivalMessage = document.getElementById("arrivalMessage");
  let hasArrived = false; // 중복 메시지 방지

function showArrivalMessage() {
  arrivalMessage.style.display = 'block';
  setTimeout(() => {
    arrivalMessage.style.display = 'none';
  }, 4000); // 4초 후 자동 숨김
}
  
  function haversineDistance(lat1, lon1, lat2, lon2) {
    const R = 6371000;
    const toRad = deg => deg * Math.PI / 180;
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    const a = Math.sin(dLat / 2) ** 2 +
              Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
              Math.sin(dLon / 2) ** 2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
  }

  function updateTarget() {
    targetLat = parseFloat(document.getElementById("targetLat").value);
    targetLon = parseFloat(document.getElementById("targetLon").value);
    alert(`✔️ 타겟 위치 설정됨: ${targetLat}, ${targetLon}`);
  }

  const gpsDisplay = document.getElementById("gpsDisplay");

  navigator.geolocation.watchPosition(
    (pos) => {
      const lat = pos.coords.latitude.toFixed(6);
      const lon = pos.coords.longitude.toFixed(6);
      const alt = pos.coords.altitude !== null ? pos.coords.altitude.toFixed(1) + "m" : "알 수 없음";

      let distanceStr = "타겟 미설정";
      if (targetLat && targetLon) {
        const distance = haversineDistance(pos.coords.latitude, pos.coords.longitude, targetLat, targetLon);
        distanceStr = distance.toFixed(1) + "m";
        
  if (distance < 10 && !hasArrived) {
    showArrivalMessage();
    hasArrived = true;
  } else if (distance >= 10) {
    hasArrived = false; // 다시 멀어지면 리셋
  }

        
      }

      gpsDisplay.textContent =
        `📍 위도: ${lat}\n📍 경도: ${lon}\n📏 거리: ${distanceStr}\n🗻 고도: ${alt}`;
    },
    (err) => {
      gpsDisplay.textContent = "❗ GPS 정보를 가져올 수 없습니다.";
    },
    { enableHighAccuracy: true }
  );
</script>


  </body>
</html>
